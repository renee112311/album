(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["album"],{ee18:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"album"}},[i("h1",{staticClass:"text-center"},[t._v("我的相簿")]),i("hr"),i("h2",[t._v("檔案上傳")]),i("br"),i("b-form",{on:{submit:t.submit}},[i("b-form-file",{attrs:{state:t.state,placeholder:"選擇檔案或拖曳至此","drop-placeholder":"拖曳至此",required:"","browse-text":"瀏覽",accept:"image/*"},on:{input:t.validateFile},model:{value:t.file,callback:function(e){t.file=e},expression:"file"}}),i("p",{staticClass:"text-danger"},[t._v("僅支援 1MB 以下的圖片")]),i("b-form-textarea",{attrs:{state:t.textstate,placeholder:"相片說明",rows:"3","max-rows":"6",maxlength:"200"},on:{input:t.validateText},model:{value:t.description,callback:function(e){t.description=e},expression:"description"}}),i("br"),i("b-button",{attrs:{type:"submit"}},[t._v("上傳")])],1),i("hr"),i("Photoswipe",[i("b-row",t._l(t.images,(function(e,a){return i("b-col",{key:a,attrs:{cols:"12",md:"6",lg:"3"}},[i("b-card",[i("b-card-img",{directives:[{name:"pswp",rawName:"v-pswp",value:e,expression:"image"}],attrs:{src:e.src}}),i("b-card-body",[e.edit?i("b-btn",{attrs:{variant:"danger"},on:{click:function(i){return t.cancel(e)}}},[t._v("取消")]):i("b-btn",{attrs:{variant:"success"},on:{click:function(i){return t.edit(e)}}},[t._v("編輯")]),e.edit?i("b-btn",{attrs:{variant:"success"},on:{click:function(i){return t.update(e)}}},[t._v("更新")]):i("b-btn",{attrs:{variant:"danger"},on:{click:function(i){return t.del(e,a)}}},[t._v("刪除")]),i("hr"),e.edit?i("b-form-textarea",{model:{value:e.model,callback:function(i){t.$set(e,"model",i)},expression:"image.model"}}):i("pre",[t._v(t._s(e.title))])],1)],1)],1)})),1)],1)],1)},s=[],l={name:"album",data(){return{file:null,description:"",state:null,textstate:null,images:[]}},computed:{user(){return this.$store.getters.user}},methods:{validateFile(){null!==this.file&&(this.file.size>=1048576||!this.file.type.includes("image")?(this.state=!1,this.file=null):this.state=!0)},validateText(){this.description.length>200?this.textstate=!1:this.textstate=!0},submit(t){if(t.preventDefault(),null===this.file||this.file.size>=1048576||!this.file.type.includes("image"))alert("檔案格式不符");else{const t=new FormData;t.append("image",this.file),t.append("description",this.description),this.axios.post("http://localhost:3000/file",t,{headers:{"Content-Type":"multipart/form-data"}}).then(t=>{this.images.push({title:this.description,src:"http://localhost:3000/file/"+t.data.name,_id:t.data._id,edit:!1,model:t.data.name}),this.file=null,this.description=""}).catch(t=>{alert(t.response.data.message)})}},edit(t){t.edit=!0,t.model=t.title},update(t){this.axios.patch("http://localhost:3000/file/"+t._id,{description:t.model}).then(e=>{t.edit=!1,t.title=t.model}).catch(()=>{alert("發生錯誤")})},cancel(t){t.edit=!1,t.model=t.title},del(t,e){this.axios.delete("http://localhost:3000/file/"+t._id).then(t=>{this.images.splice(e,1)}).catch(()=>{alert("發生錯誤")})}},mounted(){this.axios.get("http://localhost:3000/album/"+this.user).then(t=>{this.images=t.data.result.map(t=>({title:t.description,src:"http://localhost:3000/file/"+t.name,_id:t._id,edit:!1,model:t.name}))}).catch(()=>{alert("發生錯誤")})}},n=l,r=i("2877"),o=Object(r["a"])(n,a,s,!1,null,null,null);e["default"]=o.exports}}]);
//# sourceMappingURL=album.93aaf365.js.map
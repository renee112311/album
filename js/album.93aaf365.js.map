{"version":3,"sources":["webpack:///./src/views/Album.vue?3700","webpack:///src/views/Album.vue","webpack:///./src/views/Album.vue?d83d","webpack:///./src/views/Album.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","staticClass","_v","on","submit","state","validateFile","model","value","callback","$$v","file","expression","textstate","validateText","description","_l","image","idx","key","directives","name","rawName","src","$event","cancel","edit","update","del","$set","_s","title","staticRenderFns","images","computed","$store","getters","user","methods","size","type","includes","length","event","preventDefault","alert","fd","FormData","append","axios","post","headers","push","error","response","data","message","patch","delete","get","component"],"mappings":"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","file":"js/album.93aaf365.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"album\"}},[_c('h1',{staticClass:\"text-center\"},[_vm._v(\"我的相簿\")]),_c('hr'),_c('h2',[_vm._v(\"檔案上傳\")]),_c('br'),_c('b-form',{on:{\"submit\":_vm.submit}},[_c('b-form-file',{attrs:{\"state\":_vm.state,\"placeholder\":\"選擇檔案或拖曳至此\",\"drop-placeholder\":\"拖曳至此\",\"required\":\"\",\"browse-text\":\"瀏覽\",\"accept\":\"image/*\"},on:{\"input\":_vm.validateFile},model:{value:(_vm.file),callback:function ($$v) {_vm.file=$$v},expression:\"file\"}}),_c('p',{staticClass:\"text-danger\"},[_vm._v(\"僅支援 1MB 以下的圖片\")]),_c('b-form-textarea',{attrs:{\"state\":_vm.textstate,\"placeholder\":\"相片說明\",\"rows\":\"3\",\"max-rows\":\"6\",\"maxlength\":\"200\"},on:{\"input\":_vm.validateText},model:{value:(_vm.description),callback:function ($$v) {_vm.description=$$v},expression:\"description\"}}),_c('br'),_c('b-button',{attrs:{\"type\":\"submit\"}},[_vm._v(\"上傳\")])],1),_c('hr'),_c('Photoswipe',[_c('b-row',_vm._l((_vm.images),function(image,idx){return _c('b-col',{key:idx,attrs:{\"cols\":\"12\",\"md\":\"6\",\"lg\":\"3\"}},[_c('b-card',[_c('b-card-img',{directives:[{name:\"pswp\",rawName:\"v-pswp\",value:(image),expression:\"image\"}],attrs:{\"src\":image.src}}),_c('b-card-body',[(image.edit)?_c('b-btn',{attrs:{\"variant\":\"danger\"},on:{\"click\":function($event){return _vm.cancel(image)}}},[_vm._v(\"取消\")]):_c('b-btn',{attrs:{\"variant\":\"success\"},on:{\"click\":function($event){return _vm.edit(image)}}},[_vm._v(\"編輯\")]),(image.edit)?_c('b-btn',{attrs:{\"variant\":\"success\"},on:{\"click\":function($event){return _vm.update(image)}}},[_vm._v(\"更新\")]):_c('b-btn',{attrs:{\"variant\":\"danger\"},on:{\"click\":function($event){return _vm.del(image,idx)}}},[_vm._v(\"刪除\")]),_c('hr'),(!image.edit)?_c('pre',[_vm._v(_vm._s(image.title))]):_c('b-form-textarea',{model:{value:(image.model),callback:function ($$v) {_vm.$set(image, \"model\", $$v)},expression:\"image.model\"}})],1)],1)],1)}),1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"pug\">\n  #album\n    h1.text-center 我的相簿\n    hr\n    h2 檔案上傳\n    br\n    b-form(@submit=\"submit\")\n      b-form-file(\n        v-model=\"file\"\n        :state=\"state\"\n        placeholder=\"選擇檔案或拖曳至此\"\n        drop-placeholder=\"拖曳至此\"\n        required\n        browse-text=\"瀏覽\"\n        accept=\"image/*\"\n        @input=\"validateFile\"\n      )\n      p.text-danger 僅支援 1MB 以下的圖片\n      b-form-textarea(\n        v-model=\"description\"\n        :state=\"textstate\"\n        placeholder=\"相片說明\"\n        rows=\"3\"\n        max-rows=\"6\"\n        maxlength=\"200\"\n        @input=\"validateText\"\n      )\n      br\n      b-button(type=\"submit\") 上傳\n    hr\n    Photoswipe\n      b-row\n        b-col(cols=\"12\" md=\"6\" lg=\"3\" v-for=\"(image,idx) in images\" :key=\"idx\")\n          b-card\n            b-card-img(:src=\"image.src\" v-pswp=\"image\")\n            b-card-body\n              b-btn(v-if=\"image.edit\" variant=\"danger\" @click=\"cancel(image)\") 取消\n              b-btn(v-else variant=\"success\" @click=\"edit(image)\") 編輯\n              b-btn(v-if=\"image.edit\" variant=\"success\" @click=\"update(image)\") 更新\n              b-btn(v-else variant=\"danger\" @click=\"del(image,idx)\") 刪除\n              hr\n              //- pre才可以換行\n              pre(v-if=\"!image.edit\") {{image.title}}\n              b-form-textarea(v-else v-model=\"image.model\")\n</template>\n\n<script>\n\nexport default {\n  name: 'album',\n  data () {\n    return {\n      file: null,\n      description: '',\n      state: null,\n      textstate: null,\n      images: []\n    }\n  },\n  computed: {\n    user () {\n      return this.$store.getters.user\n    }\n  },\n  methods: {\n    // 驗證檔案\n    validateFile () {\n      if (this.file !== null) {\n        if (this.file.size >= 1024 * 1024 || !this.file.type.includes('image')) {\n          this.state = false\n          this.file = null\n        } else {\n          this.state = true\n        }\n      }\n    },\n    // 驗證相片說明\n    validateText () {\n      if (this.description.length > 200) {\n        this.textstate = false\n      } else {\n        this.textstate = true\n      }\n    },\n    submit (event) {\n      event.preventDefault()\n      if (this.file === null || this.file.size >= 1024 * 1024 || !this.file.type.includes('image')) {\n        alert('檔案格式不符')\n      } else {\n        // FormData 是 form 標籤裡 input 的資料，可以同時傳送檔案和表單資料\n        const fd = new FormData()\n        fd.append('image', this.file)\n        fd.append('description', this.description)\n\n        this.axios.post(process.env.VUE_APP_APIURL + '/file', fd, {\n          // 因為 axios 預設是送 json，所以要自己設定成 formdata\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        }).then(response => {\n          this.images.push(\n            {\n              title: this.description,\n              src: process.env.VUE_APP_APIURL + '/file/' + response.data.name,\n              _id: response.data._id,\n              edit: false,\n              model: response.data.name\n            }\n          )\n          this.file = null\n          this.description = ''\n        }).catch(error => {\n          alert(error.response.data.message)\n        })\n      }\n    },\n    edit (image) {\n      image.edit = true\n      image.model = image.title\n    },\n    update (image) {\n      this.axios.patch(process.env.VUE_APP_APIURL + '/file/' + image._id, { description: image.model })\n        .then(response => {\n          image.edit = false\n          image.title = image.model\n        })\n        .catch(() => {\n          alert('發生錯誤')\n        })\n    },\n    cancel (image) {\n      image.edit = false\n      image.model = image.title\n    },\n    del (image, idx) {\n      // 我們做的是真的刪除，市面上的網站的刪除是假刪除，也就是資料庫內的資料還留存，只是把欄位「是否刪除」改成「是」\n      this.axios.delete(process.env.VUE_APP_APIURL + '/file/' + image._id)\n        .then(response => {\n          this.images.splice(idx, 1)\n        })\n        .catch(() => {\n          alert('發生錯誤')\n        })\n    }\n  },\n  mounted () {\n    this.axios.get(process.env.VUE_APP_APIURL + '/album/' + this.user)\n      .then(response => {\n        // map 使回傳的資料重新組合，多加了 edit 跟 model\n        this.images = response.data.result.map(d => {\n          return {\n            title: d.description,\n            src: process.env.VUE_APP_APIURL + '/file/' + d.name,\n            _id: d._id,\n            edit: false,\n            model: d.name\n          }\n        })\n      })\n      .catch(() => {\n        alert('發生錯誤')\n      })\n  }\n\n}\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Album.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Album.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Album.vue?vue&type=template&id=6702085b&lang=pug&\"\nimport script from \"./Album.vue?vue&type=script&lang=js&\"\nexport * from \"./Album.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}